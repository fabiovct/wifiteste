<!DOCTYPE html>
<html>
    <head>
        <title>Cadastro da Fatura</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="_css/bootstrap.css" rel="stylesheet" type="text/css"/>
        <link href="_css/style.css" rel="stylesheet" type="text/css"/>         
        
    <script type='text/javascript' src='_js/jquery-3.3.1.js'></script>
    <script>
        $(document).ready(function () {
            detalhes();
        });
    </script>
       
    </head>

    <body class="content vertical-center">
        <div class="container container-index text-center mt-4 mb-4 col-10">
            <h3>Detalhes da Fatura</h3>
            <div class="form-row ml-3 mr-3">
                <h5 class="ml-3">Fatura:</h5>
                <table class="table" id="table-itens"></table>
                <h5 id="valor-total"></h5>
                
            </div>

            <div class="col text-center">
                <button id="voltar" type="button" class="btn btn-danger ml-3 mb-5">Voltar</button>
            </div>

        </div>

    </body>

    <script>
        
        $('#voltar').click(function(){
            $url =(window.location.href).split('-')[0]
            window.location.href = $url+'-historico.html'

        })

        function detalhes(){
            $.ajax({			//Função AJAX
                url:"http://localhost:8000/api/fatura/historico-faturas/"+window.localStorage.getItem('id_fatura'),
                type:"GET",				//Método de envio
                   success: function (result){			//Sucesso no AJAX
                    console.log(result)
                    $('#valor-total').append('Valor Total: '+result.preco_total)
                    $('#table-itens').append('<thead id="thead"><tr><th scope="col">Nome</th><th scope="col">Preco</th><th scope="col">Fornecedor(es)</th></tr></thead>')
                        $('#table-itens').append('<tbody id="tbody">')
                    result.itens.forEach(iten => {
                        let index=0
                        iten.produto.fornecedores.forEach(fornecedor => {
                            if(index == 0){
                                fornecedores = fornecedor['nome']
                            }else{
                                fornecedores += ', '+fornecedor['nome']
                            }
                            index++
                            
                        });


                            $('#table-itens').append('<tr><th scope="col">'+iten.produto.nome+'</th><th scope="col">'+iten.preco+'</th><th scope="col">'+fornecedores+'</th></tr>')

                        
    
                
                    });
                    $('#table-itens').append('</tbody>')


            }
        })
    }

    </script>


    </html>